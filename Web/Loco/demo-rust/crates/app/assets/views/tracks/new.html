{% extends "layouts/base.html" %}

{% block title %}Add Track - MusicLoop{% endblock %}

{% block content %}
<div class="auth-box" style="max-width:600px;">
    <h2 class="page-title" style="margin-top:0;">Add New Track</h2>
    <form id="track-form">
        <div class="form-group">
            <label for="title">Title *</label>
            <input type="text" id="title" name="title" required placeholder="Song title">
        </div>
        <div class="form-group">
            <label for="artist">Artist</label>
            <input type="text" id="artist" name="artist" placeholder="Artist name">
        </div>
        <div class="form-group">
            <label for="url">URL *</label>
            <input type="url" id="url" name="url" required placeholder="https://www.youtube.com/watch?v=...">
        </div>
        <div class="form-group">
            <label for="description">Description</label>
            <textarea id="description" name="description" placeholder="About this track..."></textarea>
        </div>
        <button type="submit" class="btn btn-primary" style="width:100%;">Add Track</button>
    </form>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('track-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const token = localStorage.getItem('token');
    if (!token) { window.location.href = '/auth/login'; return; }
    const body = {
        title: document.getElementById('title').value,
        url: document.getElementById('url').value,
    };
    const artist = document.getElementById('artist').value.trim();
    if (artist) body.artist = artist;
    const desc = document.getElementById('description').value.trim();
    if (desc) body.description = desc;

    try {
        const resp = await fetch('/api/tracks', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + token },
            body: JSON.stringify(body)
        });
        if (resp.ok) {
            window.location.href = '/my/tracks';
        } else {
            const data = await resp.json();
            alert(data.description || 'Failed to create track');
        }
    } catch (err) { console.error(err); }
});
</script>
{% endblock %}
